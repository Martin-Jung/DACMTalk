<!doctype html>
<html lang="en">

    <head>
        <meta charset="utf-8">

        <title>Monitoring land dynamics from space </title>

        <meta name="description" content="Quantitative Analysis group - Unversity of Sussex">
        <meta name="author" content="Martin Jung">

        <meta name="apple-mobile-web-app-capable" content="yes" />
        <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">

        <link rel="stylesheet" href="reveal.js/css/reveal.css">
        <link rel="stylesheet" href="reveal.js/css/theme/white.css" id="theme">

       <!-- Custom CSS -->
        <link rel="stylesheet" href="css/custom.css">


        <!-- Code syntax highlighting -->
        <link rel="stylesheet" href="reveal.js/lib/css/zenburn.css">

        <!-- Printing and PDF exports -->
	<link rel="stylesheet" media="print" href="reveal.js/css/print/pdf.css" />
	<script>
            var link = document.createElement( 'link' );
            link.rel = 'stylesheet';
            link.type = 'text/css';
            link.href = window.location.search.match( /print-pdf/gi ) ? 'reveal.js/css/print/pdf.css' : 'reveal.js/css/print/paper.css';
            document.getElementsByTagName( 'head' )[0].appendChild( link );
        </script>

        <!--[if lt IE 9]>
        <script src="reveal.js/lib/js/html5shiv.js"></script>
        <![endif]-->
    </head>

    <body>

        <div class="reveal">
            <!-- Any section element inside of this container is displayed as a slide -->

            <div class="slides">
            <!-- Title slide-->
            <section data-background-image="img/merisatUK.jpg">

                <div id="title-box">
                  <h2><i>The times they are a changin'</i><br> Monitoring land dynamics from space </h2>
                      <p>
                        Martin Jung<br>
                        <a id="link">m.jung@sussex.ac.uk</a><br>
                      </p>
                </div>
            </section>

        <section>
            <section data-markdown>
                <script type="text/template">
                <!-- .slide: data-background="white" data-transition="slide"-->

                ## My background

                  - PhD student in environmental science  <!-- .element: class="fragment fade-in" data-fragment-index="1" -->

                  - Mainly coding in R | Python | Bash <!-- .element: class="fragment fade-in" data-fragment-index="2" -->

                  <img src="img/data_scientist_ven.png" height="400px"> </img> <!-- .element: class="fragment fade-in" data-fragment-index="3" -->

                </script>
            </section>

            <section data-markdown>
                <script type="text/template">
                <!-- .slide: data-background="white" data-transition="concave"-->
                ## Global biodiversity modelling
                <img src='img/newbold.png' height="300px"/>
                <br>
                Newbold et al. (2016)
                <br> DOI: <a> 10.1126/science.aaf2201  </a>
                </script>
            </section>

            <section data-markdown>
                <script type="text/template">
                <!-- .slide: data-background="black" data-transition="concave"-->
                ## Satellite data
                <img src='img/Picture1.jpg'/>
                </script>
            </section>

            <section data-markdown>
                <script type="text/template">
                <!-- .slide: data-background="black" data-transition="concave"-->
                <img src='img/Rivers.gif'/>
                </script>
            </section>

            <section data-markdown>
                <script type="text/template">
                <!-- .slide: data-background="black" data-transition="concave"-->
                ## Multispectral images
                <img src='img/multispectral.gif' width="350" />
                <img src='img/ndvi_example.jpg' width="310" />
                </script>
            </section>

            <!-- Last -->
            <section data-markdown>
                <script type="text/template">
                <!-- .slide: data-background="black" data-transition="concave"-->
                ## Vegetation phenology
                <img src='img/Phenology.gif' width="75%"/>
                </script>
            </section>
        </section>

<!-- Starting breakpoint BFAST -->
<section>
      <section data-markdown>
          <script type="text/template">
          ## What is change ?
          <!-- .slide: data-transition="slide-in slide-out" data-background="white" -->
          <p><img src="img/ChangeTypes.png" height="500px"> </img>
          <small>Beaulieu <i>et al</i> (2012) doi: [10.1098/rsta.2011.0383](http://dx.doi.org/10.1098/rsta.2011.0383)</small>
        </p>
          </script>
      </section>

      <section data-markdown>
          <script type="text/template">
          <!-- .slide: data-transition="slide-in slide-out" data-background="#F9F9F9" -->
          ## Changes in trend
          <p>
            <b>BFAST</b>
            <br>Breaks For Additive Seasonal and Trend
          </p>
          <small>Verbesselt et al. (2010) doi: [10.1016/j.rse.2010.08.003](http://dx.doi.org/10.1016/j.rse.2010.08.003)</small>

          Decomposes and assess change in trend, seasonal and remainder term of time series

          <b>R</b>: <i>bfast</i>,  <i>strucchange</i>

          </script>
      </section>

    <section data-markdown>
        <script type="text/template">
          <div id="forms">
          `$$ Y_t = T_t + S_t + e_t $$` `$$(t = 1, ..., n) $$`
        <br>
        <hr>
        <p>
        `$$ T_t = \alpha_i + \beta_i t \\
          \tau_{j-1}^* < \tau \le \tau_j^* \quad (j = 1, \ldots, m) $$`
        </p> <!-- .element: class="fragment fade-in" data-fragment-index="1" -->
        </div>
        </script>
    </section>

    <section data-markdown>
        <script type="text/template">
        <!-- .slide: data-transition="slide-in slide-out" data-background="#F9F9F9" -->
        `$$ S_t = \sum_{k=1}^K a_{j,k} \ sin \left( \frac{2\pi k t}{f} + \delta_{j,k} \right) $$`

        <br>
        <p>
        `$ K \quad = \text{Harmonic terms} \\
         a_{j,k} \quad = \text{Amplitude} \\
         \delta_{j,k} \quad = \text{Phase} \\
         f \quad = \text{Frequency} $`
        </p>  <!-- .element: class="fragment fade-in" data-fragment-index="1" -->
        <p> `$$ \tau_{j-1}^\# < \tau \le \tau_j^\# \quad (j = 1, \ldots, p) $$` <!-- .element: class="fragment fade-in" data-fragment-index="2" -->
        </p>
        </script>
    </section>


    <section data-markdown>
        <script type="text/template">
    <!-- .slide: data-transition="slide-in slide-out" data-background="white" -->
    <img src='img/MoCos.png'/ width="600px">
    <br>
    <small>`$$ MO_t = \frac{1}{\delta \sqrt{n}} \sum_{s=t-h+1}^t \left(y_s -\hat y_s \right) $$` </small>  <!-- .element: class="fragment fade-in" data-fragment-index="1" -->

        </script>
    </section>

    <section data-markdown>
        <script type="text/template">
        <!-- .slide: data-transition="zoom-out" data-background="white" -->
        1. If test indicates presence of breakpoints:  Estimate number and position in  $$ Y_t - S_t $$ and $$ Y_t - T_t $$
        2. Reiterate until est. parameters remain unchanged. <!-- .element: class="fragment fade-in" data-fragment-index="1" -->

        </script>
    </section>

    <section data-markdown>
        <script type="text/template">
        <!-- .slide: data-transition="zoom-out" data-background="white" -->
        <img src='img/BFAST_full.png'/>

        </script>
    </section>

    <section data-markdown>
        <script type="text/template">
        <!-- .slide: data-transition="zoom-in zoom-out" data-background="white" -->
        ### Does it work ? Sort, of...
        <img src='img/BFASTSuccess.png'/>

        </script>
    </section>

</section>

<!-- Starting breakpoint PELT -->
<section>

    <section data-markdown>
        <script type="text/template">
        <!-- .slide: data-transition="convex" data-background="#F9F9F9"-->
        ### Changes in mean + variance
        Optimal detection of changepoints with a linear computational cost
        <br>
        <small>Killick et al. (2012) doi: [10.1080/01621459.2012.737745](http://dx.doi.org/10.1080/01621459.2012.737745)</small>

        </script>
    </section>

    <section data-markdown>
        <script type="text/template">
          <!-- .slide: data-transition="convex" data-background="#F9F9F9"-->
          `$$ \sum_{i=1}^{m+1} [C(y_{(\tau_{i-1}+1):\tau_i })]  + \beta f (m) $$`
          <br>
          <p>
          `$ C \quad = \text{Cost function for segment} \\
           \beta f (m)  \quad = \text{Penalty term} \\ $`
          </p>  <!-- .element: class="fragment fade-in" data-fragment-index="1" -->

        </script>
    </section>

    <section data-markdown>
        <script type="text/template">
          <!-- .slide: data-transition="convex" data-background="white"-->
          <img src='img/pelt.png'/>
          <center><small>( Source: Michael Messer - Uni Frankfurt )</small></center>
        </script>
    </section>

    <section data-markdown>
        <script type="text/template">
          <!-- .slide: data-transition="convex" data-background="white"-->
          #### Does it work ?
          <img src='img/Fig_Raw.png'/>

        </script>
    </section>

    <section data-markdown>
        <script type="text/template">
          <!-- .slide: data-transition="convex" data-background="white"-->
          <img src='img/Fig_Bfast.png'/>

        </script>
    </section>

    <section data-markdown>
        <script type="text/template">
          <!-- .slide: data-transition="convex" data-background="white"-->
          <img src='img/Fig_PELT.png'/>
        </script>
    </section>

</section>

<!-- Open call -->
<section>
    <section data-markdown>
        <script type="text/template">
          <!-- .slide: data-background="#2574A9" data-transition="fade"-->

          ### An ideal breakpoint detection?

          - Detects both changes in variance and abrupt breaks  <!-- .element: class="fragment zoom-in" data-fragment-index="1" -->
          - Can test for none, single and multiple breaks <!-- .element: class="fragment fade-in" data-fragment-index="2" -->
          - Works with missing data! <!-- .element: class="fragment fade-in" data-fragment-index="3" -->
          - robust to noise and accounts for seasonal fluctuations <!-- .element: class="fragment fade-in" data-fragment-index="3" -->
          - multivariate measurements of ordered observations ? <!-- .element: class="fragment fade-in" data-fragment-index="4" -->
          - Execution time under 5s ideally <!-- .element: class="fragment fade-in" data-fragment-index="5" -->

        </script>
    </section>

</section>

<!-- Big data processing in python -->
<section>
    <section data-markdown>
        <script type="text/template">
        <!-- .slide: data-background="white" data-transition="slide-in slide-out"-->
        ### Challenges of working with spatial data
        <div id="left">
          <img src='img/StackArrow.png'/ height="400px">
        </div>
        <div id="right">
          <p>
          Multi-dimensional
          <br>arrays x \* y \* z
          <br><br>
          Big data <br>(46 * 32y = ~1472GB)

          </p>
        </div>
        </script>
    </section>

    <section data-markdown>
        <script type="text/template">
        <!-- .slide: data-background="white" data-transition="slide-in slide-out"-->
        ### Manangement of large numbers of files

        <img src='img/ManualStorage.png'/>

        </script>
    </section>


    <section data-markdown>
        <script type="text/template">
        <!-- .slide: data-background="white" data-transition="slide-in slide-out"-->
        ### Instead Use a hierarchical file format

        <img src='img/hdf5_structure4.jpg'/>

        </script>
    </section>

    <section data-markdown>
        <script type="text/template">
        <!-- .slide: data-background="#F9F9F9" data-transition="slide-in slide-out"-->
          <img src='img/NEWStorage.png'/ border-color="black">
        <small> Compression ratio: <b> 64.2 %</b> <small>
        </script>
    </section>

    <section data-markdown>
        <script type="text/template">
        <!-- .slide: data-background="white" data-transition="slide-in slide-out"-->
        <center><pre><code data-trim>
          root group (NETCDF4 data model, file format HDF5):
              title: MCD43A4
              description: contains EVI MCD43A4 for the UK
              institution: University of Sussex, United Kingdom
              source: based on MODIS Terra & Aqua - BRDF Product
              year: 2007
              projection: WGS84
              dimensions(sizes): lat(2400), lon(2400), time(46)
              variables(dimensions): float32 time(time), float32 lat(lat), float32 lon(lon), int32 crs(), float64 metric(time,lat,lon)
         </code></pre></center>

        </script>
    </section>


    <section data-markdown>
        <script type="text/template">
        <!-- .slide: data-background="white" data-transition="slide-in slide-out"-->

        <pre><code data-trim data-noescape>
        import xray
        import matplotlib.pyplot as plt
        f = xray.open_dataset('MCD43A4_h17v03_EVI.nc')
        fm = f.sel(lon=[50.86],lat= [-0.088029], method='nearest')
        .groupby('time.dayofyear').mean()

        # Plot
        plt.plot(fm.dayofyear,fm.metric)
         </code></pre>

         <img src='img/xrayQuery.png'/ width="200px">

        </script>
    </section>
</section>

<!-- Parallel processing dask-->
<section>
    <section data-markdown>
        <script type="text/template">
        <!-- .slide: data-background="#2574A9" data-transition="zoom"-->

        ### What if my data is to large to load into memory at once ?

        <img src='img/dask.png'/> <!-- .element: class="fragment zoom-in" data-fragment-index="1" -->

        </script>
    </section>

    <section data-markdown>
        <script type="text/template">
        <!-- .slide: data-background="white" data-transition="zoom"-->
        <i>
         > Dask divides arrays into many small pieces, called chunks, and provides out-of-core computation .
        </i>

        <img src='img/dask_array.png'/>

        </script>
    </section>


    <section data-markdown>
        <script type="text/template">
        <!-- .slide: data-background="white" data-transition="zoom"-->
        <pre><code data-trim data-noescape>
        f = xray.open_dataset('MCD43A4_h17v03_EVI.nc',chunks=100)
        f_1 = f.groupby('time.month').mean('time')
        f_2 = f.mean('time') # Overall mean
        full = (f_1.sel(month=3) - f_2).metric

        # Now it gets computed
        %time result = full.load()
        </code></pre>

        </script>
    </section>

    <section data-markdown>
        <script type="text/template">
        <!-- .slide: data-background="white" data-transition="zoom"-->
        <img src='img\DaskGraph.png'/ height="500px">
        </script>
    </section>

    <section data-markdown>
        <script type="text/template">
        <!-- .slide: data-background="white" data-transition="zoom"-->
        > Total: Wall time: 17.7 s
        <img src='img\daskMarchEVI.png'/>

        </script>
    </section>

    <section data-markdown>
        <script type="text/template">
        <!-- .slide: data-background="white" data-transition="zoom"-->
        ## Extendable for multiple client workers
        <pre><code data-trim data-noescape>
        from distributed import Client
        client = Client() # distributes work process over workers
        </code></pre>

        <img src='img\grid_search_schedule.gif'/>

        </script>
    </section>


</section>

<section data-markdown>
        <script type="text/template">
        <!-- .slide: data-background="black" data-transition="zoom"-->

        ## Interesting? Helpful?
        <center>
        <img src='img/Monkey_Island_Skel.gif'/>
        </center>

        </script>
</section>


            <!-- And the rest in markdown-->
<!--            <section data-markdown="slides.md" data-separator="^------\n" data-separator-vertical="^---\n">
            </section>
            -->

            </div> <!-- End of slides -->
            <!-- Footer -->
            <div class="footer">
                <img src="img/USLogo.png" id='logo'/>
            </div>
        </div>

        <script src="reveal.js/lib/js/head.min.js"></script>
        <script src="reveal.js/js/reveal.js"></script>

        <script>

            // Full list of configuration options available at:
            // https://github.com/hakimel/reveal.js#configuration
            Reveal.initialize({
                controls: true, // Display controls in the bottom right corner
                progress: true, // Display a presentation progress bar
                slideNumber: 'c/t',//'c / t', // page number on current slide
                history: true,
                center: true,

                transition: 'slide', // none/fade/slide/convex/concave/zoom
                backgroundTransition: 'fade', // none/fade/slide/convex/concave/zoom

                math: {
                    mathjax: 'https://cdn.mathjax.org/mathjax/latest/MathJax.js',
                    config: 'TeX-AMS_HTML-full'  // See http://docs.mathjax.org/en/latest/config-files.html
                },

                // Optional reveal.js plugins
                dependencies: [
                    { src: 'reveal.js/lib/js/classList.js', condition: function() { return !document.body.classList; } },
                    { src: 'reveal.js/plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
                    { src: 'reveal.js/plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
                    { src: 'reveal.js/plugin/highlight/highlight.js', async: true, condition: function() { return !!document.querySelector( 'pre code' ); }, callback: function() { hljs.initHighlightingOnLoad(); } },
                    { src: 'reveal.js/plugin/zoom-js/zoom.js', async: true },
                    { src: 'reveal.js/plugin/math/math.js', async: true },
                    { src: 'reveal.js/plugin/notes/notes.js', async: true }
                ]
            });

        </script>

    </body>
</html>
